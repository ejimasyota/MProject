
【個人用 : 仕様】
______________________________________________________________________________________________________________________________________________________

【1】web仕様

【作成物】
  ↳ 1 .画面クリックで進行する分岐式WEBノベルゲーム

【OS】
  ↳ 1 .Windows
  
【言語】
  ↳ 1 .フロントエンド
       ↳ ①HTML
         ②JavaScript
    2 .UI
       ↳ ①CSS
        
【バージョン管理】
  ↳ 1 .Git
  
【方針】
  ↳ 1 .変数名・関数名の記述はパスカルケースで行う
    2 .機能追加や修正を容易にするために各コンポーネント間の依存はできる限り減らす
    3 .エラーログのみ出力を行う
    4 .各JSファイルでダイアログやフォームを作成する際は、innerhtmlではなく、createElementで行う
    5 .レスポンシブには対応しない
 
【想定画面】
  ↳ 1 .スタート画面(Start.html)
    2 .セーブスロット選択画面(SelectSaveSlot.html)
    3 .説明所画面(優先度 : 低)(GameInfo.html)
    4 .キャラ説明画面(CharaInfo.html) --不要(2025/11/11)
    5 .ゲーム画面(Game.html)
    6 .ミニゲーム画面(MiniGameInfo.html))
        
【想定ダイアログ】
  ↳ 1 .スピナーダイアログ(LoadingDialog.js)
    2 .メッセージダイアログ(MessageDialog.js)
    3 .コンファームダイアログ(ConfirmDialog.js)
    
【想定モジュール】
  ↳ 1 .名前入力フォーム(NameInputForm.js)
    3 .メッセージボックス
    4 .バックログリスト
    5 .メニューリスト
    6 .各ミニゲーム
    7 .ツールチップ
    8 .カットイン

【プレイヤーIDの発行】
  ↳ 1 .セーブスロット選択画面ロード時にローカルストレージ内から[M_PlayerId]というキーを取得
    2 .取得できた場合はSaveInfo.jsonからプレイヤーIDに紐づくキーデータをすべて取得
    3 .取得できなかった場合はUUID(プレイヤーID)を作成し、[M_PlayerId]というキーで保持。その後、SaveInfo.jsonにキーを追加する。

【名前入力フォームについて】
  ↳ 1 .名前入力フォームには、入力フォームと決定ボタンを横並びに配置する(コンテナがってもいい)
    2 .決定ボタンを押下時に、PlayerNameというキーで入力値をセッションに登録する
       その際、PlayerNameと登録年月日をSaveInfo.jsonにセーブスロットIDとプレイヤーIDをキーに追加する

【プレイヤーIDの考え方】
  ↳ 1 .プレイヤーID一つにつき、SaveInfo.jsonキー内の要素数は3つまで

【SaveInfo.jsonの構成】
    SaveItem : [
                "作成されたプレイヤーID" : [
                                            "SaveSlot1" : {
                                                            "PlayerName" : "",   --ゲーム画面で登録されたプレイヤー名
                                                            "StoryId" : "",      --セーブ時点のストーリーID
                                                            "StartDate" : "",    --ゲーム開始時年月日
                                                            "EndDate" : "",      --セーブ時点での現在年月日 
                                                          }
                                            ]
              ]

【プレイヤーIDの持ち方】
  ↳ 1 .よくない方法ではあるが、友人間で遊ぶ程度なのでローカルストレージに保持する
  
【セーブスロット選択時】
  ↳ 1 .選択されたセーブスロットのID、ローカルストレージ内のプレイヤーIDをキーとしてSaveInfo.jsonから取得を行い、取得したストーリーIDに紐づくテキストをStoryInfo.jsonから取得
    2 .取得した内容に紐づき画面を設定
    3 .BackLog.jsonからプレイヤーID、セーブスロットIDに紐づくバックログ項目を取得し、バックログ情報保持用の配列に保持
    4 .バックログの取得に時間がかかると思うので、スピナーを表示する
    5 .SaveInfo.json内のPlayerNameをPlayerNameというキーでセッションに登録(これはローカルに保持する必要はない)
    6 .選択されたセーブスロットのID、ローカルストレージ内のプレイヤーIDに紐づくデータのストーリーIDが1で、なおStartDateの値が空の場合は最初からの開始として扱う
    7 .選択時、セーブスロットのIDはセッションに保持する

 
【新規でゲーム開始→セーブを実行せずに画面を終了した場合】
  ↳ 1 .セーブスロット選択画面ロード時に、SaveInfo.json内で登録年月日は存在するが更新年月日が存在しないキーデータの削除を実行する。この際キーはプレイヤーIDとする。 --名前入力決定時にオートセーブとする(2025/11/11)

【プレイ時間の算出】
  ↳ 1 .セーブスロット選択画面ロード時に、SaveInfo.jsonの登録年月日と更新年月日の差異を算出し、それをプレイ時間とする。
    
【バックログの表示ロジック】
  ↳ 1 .画面クリックで進行し、その際に取得したテキストをバックログ用の配列に保持する。形式は下記の通り
       [{
          narrator : "",
          storyText : ""
         }]
    2 .バックログ表示ボタンの押下時に、その配列の内容をバックログとして表示を行う、形式は下記の通り
       名前 | 「テキスト」
    3 .名前はStoryInfo.jsonのNarratorのキーから値を取得する
    4 .セーブ実行時に、配列の内容をキー項目ごとにBackLog.jsonに登録する。

【ストーリー管理方法】
  ↳ 1 .StoryInfo.jsonというファイルを作成し、そこにストーリー内容をストーリーIDに紐づけて管理する。キー項目の状態によって画面のイベントを変えたいが、新規で機能を追加する場合の保守性に欠けてしまうか
       基本コピペで項目を設定する想定
    2 .下記は構成のイメージ
        StoryItem : [{
                     "StoryId" : 1,                           --ストーリーのID
                     "Narrator" : "A子",                      --語り手の名前。空の場合はフロント側でプレイヤー名を設定する
                     "StoryTitle" : "始まり",                 --章のタイトル
                     "StoryText" : "今日もいい天気",          --ストーリー内容
                     "Next" : 2,                              --次のシーン
                     "Back" : 0,                              --前のシーン
                     "BgPath" : "../assets/img/bg/bg.png"     --背景画像パス
                     "SePath" : "",                           --SEのパス
                     "Voice"  : "",                           --ボイスのパス
                     "Flg" : [{
                             "MessageBoxFlg" : false,         --メッセージボックスの表示・非表示を制御するFLG
                             "NameInputFlg" : true,           --名前入力フォームの呼び出しFLG。StoryIdが1の場合でしか設定されない想定
                             "EndFlg" : "",                   --ストーリー終了時の判別FLG
                             "CutInFlg" : false,              --カットイン画像の表示FLG
                             "DisabledFlg" : false,           --メニューリストの各ボタンの活性・非活性を制御するFLG
                             "EyeCatchFlg" : false,           --アイキャッチ表示FLG
                             "GameFlg" : false,               --ミニゲーム発生フラグ(勝った際のシナリオ、負けた際のシナリオはJS側で呼び出しを分岐させればよい)
                             "AutoSaveFlg" : false,           --自動でセーブを行うFLG
                             }],
                     "MoviePath" : "",                        --動画ファイルのパス
                     "CharaImgPath" : [{
                                       "Center" : "",         --中央に配置する画像パス
                                       "Right" : "",          --画面右側に配置する画像パス
                                       "Left" : ""            --画面左に配置する画像パス
                                      }]
                     "BgmPath" : "",                          --再生するBGMのパス
                     "FaceImgPath" : "",                      --メッセージボックスに表示させる顔アイコン画像パス
                     "Effect" : [{
                                  "Spin" : [{
                                            "Center" : false, --中央画像を回転させるFLG
                                            "Right" : false,  --右画像を回転させるFLG
                                            "Left"  : false   --左画像を回転させるFLG
                                           }],
                                  "Jump" : [{
                                            "Center" : false, --中央画像を上昇させるFLG
                                            "Right" : false,  --右画像を上昇させるFLG
                                            "Left"  : false   --左画像を上昇させるFLG
                                           }],
                                  "Wave" : [{
                                            "Center" : false, --中央画像を左右に揺らすFLG
                                            "Right" : false,  --右画像を左右に揺らすFLG
                                            "Left"  : false   --左画像を左右に揺らすFLG
                                           }]
                                
                                }],
                     "Select": [                           --選択肢
                          {
                            "StoryText": "散歩に出かける",
                            "Next": 2,
                            "Back" : 1
                          },
                          {
                            "StoryText": "部屋で本を読む",
                            "Next": 3,
                            "Back" : 1
                          }
                        ],
                     "$$$$$$$$" : "",                      --機能追加があった際に置換を行う文字列。無理やりすぎるが現時点での解決策もないため
                     "||||||||" : "",
                     "★★★★" : "",
                     "@@@@@@@@" : "",
                     "&&&&&&&&" : "",
                     "%%%%%%%%" : ""
                   }]
      
【画面で設定されたプレイヤー名をStoryTextに埋め込むロジック】
  ↳ 1 .StoryText内でプレイヤー名を使用するような内容を作成する場合は、置換できる文字列を用意しておく。下記は例
       "こんにちは！{PlayerName}さん！"
    2 .セッションに登録されたPlayerNameの値を使って置換を行う
      
【セーブロジック】
  ↳ 1 .セーブ実行時に、下記項目をSaveInfo.jsonに登録する
       ↳ ①セーブID
         ②セーブスロットID
         ③プレイヤーID
         ④更新年月日
         ⑤プレイヤー名
    2.セーブID、セーブスロットID、プレイヤーIDの衝突があった場合は更新、それ以外では追加を行う

【セーブデータ削除】
  ↳ 1 .セーブスロットに配置された削除ボタン押下時にSaveInfo.jsonからの削除を実行する
    2 .削除に使うキーはセーブスロットID、プレイヤーID、
    3 .削除を行うJSONは、SaveInfo.jsonとBackLog.json
    

【ミニゲームロジック】
  ↳ 1 .StoryInfo.jsonで取得したGameFlgがTRUEの場合、StoryIdの値に応じたミニゲームを発生させる。
       例えば、GameFlgがTRUEでStoryIdが1ならテトリス、StoryIdが5ならシューティングなど
    2 .ミニゲーム勝利時と敗北時で分岐したStoryIdを返し、その値に応じたストーリーをStoryInfo.jsonから呼び出す
    3 .クラスの引数には、StoryInfo.jsonで取得したStoryIdの値を渡す。クラス内でゲームを分岐させるように。
      イメージは下記の通り
      <ミニゲームクラス>
        StoryIdの値が1 → <テトリスクラス>を呼び出し。勝利時はtrue、敗北時はfalseをミニゲームコンポーネントに返し、それに応じたStoryIdを呼び出しもとに返す。
    4 .1つのミニゲームクラスにつき1JSファイルの想定。
        
【画面クリック時のロジック】
  ↳ 1 .ゲーム画面での初期画面クリック時、StoryInfo.jsonを呼び出して配列JSON化し、その先頭要素の項目を画面に設定し、次のクリック時には先頭要素のNextのキーに設定された値番目の要素を参照し、その項目を画面に設定する
       いちいちJSONファイルにアクセスするのは時間がかかりそう
    2 .StoryInfo.jsonのGameFlgの値がTRUEの場合に限り、ミニゲームクラスからの戻り値番目の要素を参照する。
       ミニゲーム終了時に自動で次の項目を画面に設定したいので、ミニゲームクラスの画面を閉じた際にクリックイベントを明示的に発火させる
    3 .Nextの値を保持する変数を定義しておき、初回以降のクリックイベントではその値の要素を参照するようにすべきか
       参照されるたびに更新させる想定

【選択肢の表示ロジック】
  ↳ 1 .StoryInfo.jsonのSelectのキーの値の要素数分の選択肢を動的にJSで作成する
    2 .選択された選択肢によって次に参照するStoryIdの値が切り替わる
______________________________________________________________________________________________________________________________________________________